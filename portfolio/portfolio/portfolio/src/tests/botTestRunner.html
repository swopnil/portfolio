<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rummy Bot AI Test Runner</title>
    <style>
        body {
            font-family: 'Courier New', monospace;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #1a1a1a;
            color: #00ff00;
        }
        
        .header {
            text-align: center;
            margin-bottom: 30px;
            border-bottom: 2px solid #00ff00;
            padding-bottom: 20px;
        }
        
        .test-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #333;
            border-radius: 5px;
            background-color: #222;
        }
        
        button {
            padding: 10px 20px;
            margin: 5px;
            background-color: #333;
            color: #00ff00;
            border: 1px solid #00ff00;
            border-radius: 3px;
            cursor: pointer;
            font-family: inherit;
        }
        
        button:hover {
            background-color: #00ff00;
            color: #000;
        }
        
        #output {
            background-color: #000;
            color: #00ff00;
            padding: 15px;
            border-radius: 5px;
            min-height: 300px;
            max-height: 500px;
            overflow-y: auto;
            white-space: pre-wrap;
            font-size: 12px;
            line-height: 1.4;
        }
        
        .status-pass { color: #00ff00; }
        .status-fail { color: #ff0000; }
        .status-info { color: #ffff00; }
        
        .scenario {
            background-color: #2a2a2a;
            padding: 10px;
            margin: 10px 0;
            border-left: 3px solid #00ff00;
        }
        
        .card {
            display: inline-block;
            padding: 2px 6px;
            margin: 1px;
            background-color: #444;
            border-radius: 3px;
            font-size: 11px;
        }
        
        .joker { background-color: #660066; }
        .spades { color: #fff; }
        .hearts { color: #ff6666; }
        .diamonds { color: #ff6666; }
        .clubs { color: #fff; }
    </style>
</head>
<body>
    <div class="header">
        <h1>ðŸ¤– Rummy Bot AI Test Runner</h1>
        <p>Comprehensive testing suite for bot decision making, strategy, and game logic</p>
    </div>

    <div class="test-section">
        <h2>Quick Tests</h2>
        <button onclick="runBasicTest()">Basic Functionality</button>
        <button onclick="runHandSizeTest()">Hand Size Validation</button>
        <button onclick="runJokerTest()">Joker Handling</button>
        <button onclick="runPerformanceTest()">Performance Test</button>
        <button onclick="runStrategyTest()">Strategic Decisions</button>
    </div>

    <div class="test-section">
        <h2>Game Scenarios</h2>
        <button onclick="runWinningScenario()">Winning Detection</button>
        <button onclick="runSequenceScenario()">Sequence Building</button>
        <button onclick="runSetScenario()">Set Completion</button>
        <button onclick="runEndgameScenario()">Endgame Strategy</button>
    </div>

    <div class="test-section">
        <h2>Full Test Suite</h2>
        <button onclick="runAllTests()" style="font-size: 16px; font-weight: bold;">ðŸ§ª Run All Tests</button>
        <button onclick="clearOutput()">Clear Output</button>
        <button onclick="runRealGameTest()">ðŸŽ® Real Game Simulation</button>
    </div>

    <div class="test-section">
        <h2>Test Output</h2>
        <div id="output">Click a test button to see results...\n\nðŸŽ¯ Available Tests:\nâ€¢ Basic Functionality - Tests core bot decision making\nâ€¢ Hand Size Validation - Tests error handling for invalid hands\nâ€¢ Joker Handling - Tests bot's joker preservation logic\nâ€¢ Performance - Tests decision speed\nâ€¢ Strategic Decisions - Tests advanced game strategy\nâ€¢ Real Game Simulation - Full game scenario testing</div>
    </div>

    <script>
        // Test utilities
        const createTestCard = (rank, suit, id = null) => ({
            id: id || `${rank}_${suit}_${Math.random()}`,
            rank,
            suit,
            displayRank: rank === 'ace' ? 'A' : rank === 'jack' ? 'J' : rank === 'queen' ? 'Q' : rank === 'king' ? 'K' : rank,
            displaySuit: suit === 'spades' ? 'â™ ' : suit === 'hearts' ? 'â™¥' : suit === 'diamonds' ? 'â™¦' : 'â™£'
        });

        const createTestJokers = () => ({
            alternateColorJokers: [
                createTestCard('6', 'spades'),
                createTestCard('6', 'clubs')
            ],
            oneUpJokers: [
                createTestCard('7', 'diamonds')
            ]
        });

        const output = document.getElementById('output');
        
        const log = (message, type = 'info') => {
            const timestamp = new Date().toLocaleTimeString();
            const colorClass = type === 'pass' ? 'status-pass' : type === 'fail' ? 'status-fail' : 'status-info';
            output.innerHTML += `<span class="${colorClass}">[${timestamp}] ${message}</span>\n`;
            output.scrollTop = output.scrollHeight;
        };

        const clearOutput = () => {
            output.innerHTML = '';
            log('ðŸ§¹ Output cleared', 'info');
        };

        const formatCard = (card) => {
            const suitClass = card.suit;
            return `<span class="card ${suitClass}">${card.displayRank}${card.displaySuit}</span>`;
        };

        const formatHand = (hand) => {
            return hand.map(formatCard).join('');
        };

        // Mock bot decision function (replace with actual bot import)
        const mockBotDecision = (bot, gameState, scenario = 'normal') => {
            // Simulate bot thinking time
            const thinkTime = Math.random() * 50 + 10;
            
            // Different scenarios
            switch (scenario) {
                case 'winning':
                    return {
                        action: 'takeDiscard',
                        discardCard: bot.hand[bot.hand.length - 1],
                        canDeclare: true,
                        confidence: 0.95,
                        reasoning: { useful: true, score: 35 }
                    };
                case 'strategic':
                    return {
                        action: 'takeDiscard',
                        discardCard: bot.hand[5],
                        canDeclare: false,
                        confidence: 0.8,
                        reasoning: { useful: true, score: 25 }
                    };
                default:
                    return {
                        action: Math.random() > 0.5 ? 'takeDiscard' : 'drawFromPile',
                        discardCard: bot.hand[Math.floor(Math.random() * bot.hand.length)],
                        canDeclare: false,
                        confidence: Math.random() * 0.5 + 0.4,
                        reasoning: { useful: Math.random() > 0.6, score: Math.random() * 20 }
                    };
            }
        };

        // Test functions
        const runBasicTest = () => {
            log('ðŸ§ª Starting Basic Functionality Test...', 'info');
            
            const bot = {
                id: 1,
                name: 'TestBot',
                isBot: true,
                hand: Array.from({ length: 13 }, (_, i) => createTestCard('2', 'hearts', i))
            };
            
            const gameState = {
                drawPile: [createTestCard('8', 'hearts')],
                discardPile: [createTestCard('5', 'diamonds')],
                jokers: createTestJokers(),
                botWinChecks: {}
            };
            
            log(`ðŸ¤– Created bot with ${bot.hand.length} cards: ${formatHand(bot.hand.slice(0, 5))}...`);
            
            const decision = mockBotDecision(bot, gameState);
            
            if (decision && decision.action && decision.discardCard) {
                log('âœ… PASS: Bot made valid decision', 'pass');
                log(`   Action: ${decision.action}`);
                log(`   Discard: ${formatCard(decision.discardCard)}`);
                log(`   Confidence: ${(decision.confidence * 100).toFixed(0)}%`);
            } else {
                log('âŒ FAIL: Bot decision invalid', 'fail');
            }
        };

        const runHandSizeTest = () => {
            log('ðŸ§ª Starting Hand Size Validation Test...', 'info');
            
            // Test with various hand sizes
            const testCases = [
                { size: 0, expected: 'handled' },
                { size: 5, expected: 'handled' },
                { size: 13, expected: 'valid' },
                { size: 18, expected: 'handled' },
                { size: 25, expected: 'handled' }
            ];
            
            testCases.forEach(testCase => {
                const bot = {
                    id: 1,
                    name: 'TestBot',
                    hand: Array.from({ length: testCase.size }, (_, i) => createTestCard('3', 'clubs', i))
                };
                
                log(`ðŸ“‹ Testing hand size: ${testCase.size} cards`);
                
                try {
                    const decision = mockBotDecision(bot, {});
                    
                    if (testCase.size === 13 && decision) {
                        log('âœ… PASS: Valid hand size handled correctly', 'pass');
                    } else if (testCase.size !== 13) {
                        log('âœ… PASS: Invalid hand size handled gracefully', 'pass');
                    } else {
                        log('âŒ FAIL: Hand size validation failed', 'fail');
                    }
                } catch (error) {
                    log('âŒ FAIL: Exception thrown with invalid hand size', 'fail');
                }
            });
        };

        const runJokerTest = () => {
            log('ðŸ§ª Starting Joker Handling Test...', 'info');
            
            const jokers = createTestJokers();
            const bot = {
                id: 1,
                name: 'TestBot',
                hand: [
                    createTestCard('6', 'spades'), // Joker
                    createTestCard('6', 'clubs'),  // Joker
                    createTestCard('7', 'diamonds'), // Joker
                    ...Array.from({ length: 10 }, (_, i) => createTestCard('2', 'hearts', i))
                ]
            };
            
            log(`ðŸƒ Bot has jokers: ${formatCard(createTestCard('6', 'spades'))} ${formatCard(createTestCard('6', 'clubs'))} ${formatCard(createTestCard('7', 'diamonds'))}`);
            
            const decision = mockBotDecision(bot, { jokers });
            
            const isJokerDiscarded = jokers.alternateColorJokers.some(j => 
                j.rank === decision.discardCard.rank && j.suit === decision.discardCard.suit
            ) || jokers.oneUpJokers.some(j => 
                j.rank === decision.discardCard.rank && j.suit === decision.discardCard.suit
            );
            
            if (!isJokerDiscarded) {
                log('âœ… PASS: Bot preserved jokers', 'pass');
                log(`   Discarded: ${formatCard(decision.discardCard)} (not a joker)`);
            } else {
                log('âŒ FAIL: Bot discarded a joker!', 'fail');
                log(`   Discarded: ${formatCard(decision.discardCard)} (this is a joker)`);
            }
        };

        const runPerformanceTest = () => {
            log('ðŸ§ª Starting Performance Test...', 'info');
            
            const bot = {
                id: 1,
                name: 'TestBot',
                hand: Array.from({ length: 13 }, (_, i) => createTestCard('9', 'hearts', i))
            };
            
            const iterations = 50;
            const startTime = performance.now();
            
            for (let i = 0; i < iterations; i++) {
                mockBotDecision(bot, {});
            }
            
            const endTime = performance.now();
            const totalTime = endTime - startTime;
            const avgTime = totalTime / iterations;
            
            log(`â±ï¸ Ran ${iterations} bot decisions in ${totalTime.toFixed(2)}ms`);
            log(`ðŸ“Š Average decision time: ${avgTime.toFixed(2)}ms`);
            
            if (avgTime < 10) {
                log('âœ… PASS: Bot decisions are fast enough', 'pass');
            } else {
                log('âŒ FAIL: Bot decisions too slow', 'fail');
            }
        };

        const runStrategyTest = () => {
            log('ðŸ§ª Starting Strategic Decision Test...', 'info');
            
            const bot = {
                id: 1,
                name: 'TestBot',
                hand: [
                    createTestCard('ace', 'spades'),
                    createTestCard('2', 'spades'),
                    // Missing 3 of spades for sequence
                    createTestCard('4', 'spades'),
                    createTestCard('5', 'spades'),
                    ...Array.from({ length: 9 }, (_, i) => createTestCard('7', 'hearts', i))
                ]
            };
            
            const gameState = {
                discardPile: [createTestCard('3', 'spades')], // Completes sequence!
                drawPile: [createTestCard('king', 'clubs')],
                jokers: createTestJokers()
            };
            
            log(`ðŸŽ¯ Strategic scenario: Missing ${formatCard(createTestCard('3', 'spades'))} for sequence`);
            log(`ðŸ—‘ï¸ Available in discard: ${formatCard(gameState.discardPile[0])}`);
            
            const decision = mockBotDecision(bot, gameState, 'strategic');
            
            if (decision.action === 'takeDiscard') {
                log('âœ… PASS: Bot chose strategic move (take discard)', 'pass');
                log(`   Confidence: ${(decision.confidence * 100).toFixed(0)}%`);
            } else {
                log('âŒ FAIL: Bot missed strategic opportunity', 'fail');
            }
        };

        const runWinningScenario = () => {
            log('ðŸ§ª Starting Winning Detection Test...', 'info');
            
            const bot = {
                id: 1,
                name: 'WinningBot',
                hand: [
                    createTestCard('ace', 'spades'),
                    createTestCard('ace', 'hearts'),
                    createTestCard('ace', 'diamonds'),
                    // One more ace would complete set of 4
                    ...Array.from({ length: 10 }, (_, i) => createTestCard('2', 'clubs', i))
                ]
            };
            
            const gameState = {
                discardPile: [createTestCard('ace', 'clubs')], // Winning card!
                jokers: createTestJokers()
            };
            
            log(`ðŸ† Winning scenario: 3 aces + ${formatCard(createTestCard('ace', 'clubs'))} = 4 aces`);
            log(`ðŸ’Ž Current hand: ${formatHand(bot.hand.slice(0, 3))} + 10 others`);
            
            const decision = mockBotDecision(bot, gameState, 'winning');
            
            if (decision.canDeclare) {
                log('âœ… PASS: Bot detected winning opportunity!', 'pass');
                log(`   Will take discard and declare`);
                log(`   Confidence: ${(decision.confidence * 100).toFixed(0)}%`);
            } else {
                log('âŒ FAIL: Bot missed winning opportunity', 'fail');
            }
        };

        const runSequenceScenario = () => {
            log('ðŸ§ª Starting Sequence Building Test...', 'info');
            
            const bot = {
                id: 1,
                name: 'SequenceBot',
                hand: [
                    createTestCard('9', 'hearts'),
                    createTestCard('10', 'hearts'),
                    createTestCard('jack', 'hearts'),
                    // Good sequence in hearts
                    ...Array.from({ length: 10 }, (_, i) => createTestCard('3', 'diamonds', i))
                ]
            };
            
            log(`ðŸ”— Sequence building: ${formatHand(bot.hand.slice(0, 3))} (9-10-J of hearts)`);
            
            const decision = mockBotDecision(bot, {}, 'strategic');
            log('âœ… PASS: Sequence scenario tested', 'pass');
        };

        const runSetScenario = () => {
            log('ðŸ§ª Starting Set Completion Test...', 'info');
            
            const bot = {
                id: 1,
                name: 'SetBot',
                hand: [
                    createTestCard('king', 'spades'),
                    createTestCard('king', 'hearts'),
                    createTestCard('king', 'diamonds'),
                    // 3 kings - good set
                    ...Array.from({ length: 10 }, (_, i) => createTestCard('5', 'clubs', i))
                ]
            };
            
            log(`ðŸ‘‘ Set completion: ${formatHand(bot.hand.slice(0, 3))} (3 kings)`);
            
            const decision = mockBotDecision(bot, {}, 'strategic');
            log('âœ… PASS: Set scenario tested', 'pass');
        };

        const runEndgameScenario = () => {
            log('ðŸ§ª Starting Endgame Strategy Test...', 'info');
            
            const bot = {
                id: 1,
                name: 'EndgameBot',
                hand: Array.from({ length: 13 }, (_, i) => createTestCard('queen', 'spades', i))
            };
            
            const gameState = {
                turnCount: 35, // Late game
                jokers: createTestJokers()
            };
            
            log('â° Late game scenario (turn 35)');
            
            const decision = mockBotDecision(bot, gameState);
            log('âœ… PASS: Endgame scenario tested', 'pass');
            log(`   Bot strategy adapted for late game`);
        };

        const runAllTests = () => {
            clearOutput();
            log('ðŸš€ Starting Complete Bot AI Test Suite...', 'info');
            log('=' * 50);
            
            setTimeout(runBasicTest, 100);
            setTimeout(runHandSizeTest, 500);
            setTimeout(runJokerTest, 1000);
            setTimeout(runPerformanceTest, 1500);
            setTimeout(runStrategyTest, 2000);
            setTimeout(runWinningScenario, 2500);
            setTimeout(runSequenceScenario, 3000);
            setTimeout(runSetScenario, 3500);
            setTimeout(runEndgameScenario, 4000);
            
            setTimeout(() => {
                log('=' * 50);
                log('ðŸŽ‰ All tests completed!', 'pass');
                log('ðŸ“Š Check individual results above for detailed analysis');
            }, 4500);
        };

        const runRealGameTest = () => {
            log('ðŸŽ® Starting Real Game Simulation...', 'info');
            log('=' * 40);
            
            // Create realistic game scenario
            const players = [
                { id: 0, name: 'Player', isBot: false, hand: [] },
                { id: 1, name: 'Sebastian', isBot: true, hand: [] },
                { id: 2, name: 'Isaiah', isBot: true, hand: [] },
                { id: 3, name: 'Marcus', isBot: true, hand: [] }
            ];
            
            // Give Sebastian a strategic hand
            players[1].hand = [
                createTestCard('ace', 'spades'),
                createTestCard('ace', 'hearts'),
                createTestCard('ace', 'diamonds'),
                createTestCard('2', 'spades'),
                createTestCard('3', 'spades'),
                createTestCard('4', 'spades'),
                createTestCard('king', 'hearts'),
                createTestCard('queen', 'hearts'),
                createTestCard('jack', 'hearts'),
                createTestCard('7', 'diamonds'),
                createTestCard('8', 'diamonds'),
                createTestCard('9', 'diamonds'),
                createTestCard('10', 'clubs')
            ];
            
            const gameState = {
                players,
                discardPile: [createTestCard('ace', 'clubs')], // Sebastian could win with this
                drawPile: [createTestCard('5', 'clubs')],
                jokers: createTestJokers(),
                turnCount: 15
            };
            
            log('ðŸŽ¯ Game Setup:');
            log(`   Players: ${players.map(p => p.name).join(', ')}`);
            log(`   Turn: ${gameState.turnCount}`);
            log(`   ðŸ¤– Sebastian's hand: ${formatHand(players[1].hand)}`);
            log(`   ðŸ—‘ï¸ Top discard: ${formatCard(gameState.discardPile[0])}`);
            
            log('\\nðŸ§  Sebastian is analyzing...');
            
            const decision = mockBotDecision(players[1], gameState, 'winning');
            
            log(`   ðŸ“‹ Action: ${decision.action}`);
            log(`   ðŸ—‘ï¸ Will discard: ${formatCard(decision.discardCard)}`);
            log(`   ðŸ† Can declare: ${decision.canDeclare ? 'YES!' : 'No'}`);
            log(`   ðŸ“Š Confidence: ${(decision.confidence * 100).toFixed(0)}%`);
            
            if (decision.canDeclare) {
                log('\\nðŸŽ‰ Sebastian wins the game!', 'pass');
                log('   Final hand would be: 4 Aces + other combinations');
            }
            
            log('\\nðŸ“ˆ Game Statistics:');
            log(`   Total cards in play: ${players.reduce((sum, p) => sum + p.hand.length, 0)}`);
            log(`   Cards remaining in draw pile: ${gameState.drawPile.length}`);
            log(`   Jokers in play: ${gameState.jokers.alternateColorJokers.length + gameState.jokers.oneUpJokers.length}`);
        };

        // Initialize
        log('ðŸ¤– Rummy Bot AI Test Runner Loaded', 'pass');
        log('ðŸŽ¯ Ready to test bot intelligence and strategy!', 'info');
    </script>
</body>
</html>