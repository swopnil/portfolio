<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simple Enhanced Bot Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background: #f0f0f0;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            margin: 5px;
            border-radius: 5px;
            cursor: pointer;
        }
        button:hover {
            background: #0056b3;
        }
        .console {
            background: #1e1e1e;
            color: #e0e0e0;
            padding: 15px;
            border-radius: 5px;
            height: 400px;
            overflow-y: auto;
            font-family: monospace;
            font-size: 12px;
            margin-top: 20px;
        }
        .loading {
            display: none;
            color: #007bff;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üéÆ Simple Enhanced Bot Rummy Test</h1>
        <p>Test if the enhanced bots can actually win games (no module imports).</p>
        
        <div>
            <button onclick="runSingleGame()">Run Single Game</button>
            <button onclick="run5Games()">Run 5 Games</button>
            <button onclick="clearConsole()">Clear Console</button>
        </div>
        
        <div id="loading" class="loading">Running simulation...</div>
        
        <div id="console" class="console">
            <div>üéÆ Simple Enhanced Bot Test Console</div>
            <div>Click a button above to start testing...</div>
        </div>
    </div>

    <script>
        // Enhanced Bot Simulation Code (embedded to avoid module issues)
        
        // Card creation utilities
        const createSimulationCard = (rank, suit, id = null) => ({
            id: id || `${rank}_${suit}_${Math.random()}`,
            rank,
            suit,
            displayRank: rank === 'ace' ? 'A' : rank === 'jack' ? 'J' : rank === 'queen' ? 'Q' : rank === 'king' ? 'K' : rank,
            displaySuit: suit === 'spades' ? '‚ô†' : suit === 'hearts' ? '‚ô•' : suit === 'diamonds' ? '‚ô¶' : '‚ô£',
            fileName: `/cards/${rank}_of_${suit}.png`
        });

        const createFullDeck = () => {
            const suits = ['spades', 'hearts', 'diamonds', 'clubs'];
            const ranks = ['ace', '2', '3', '4', '5', '6', '7', '8', '9', '10', 'jack', 'queen', 'king'];
            const deck = [];
            
            // Create 3 decks as per rummy rules
            for (let deckNum = 0; deckNum < 3; deckNum++) {
                for (const suit of suits) {
                    for (const rank of ranks) {
                        deck.push(createSimulationCard(rank, suit, `${rank}_${suit}_${deckNum}`));
                    }
                }
            }
            
            // Shuffle deck
            for (let i = deck.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [deck[i], deck[j]] = [deck[j], deck[i]];
            }
            
            return deck;
        };

        const createSimulationJokers = (wildcard) => {
            if (!wildcard) return { alternateColorJokers: [], oneUpJokers: [] };
            
            const isWildcardRed = wildcard.suit === 'hearts' || wildcard.suit === 'diamonds';
            const alternateSuits = isWildcardRed ? ['spades', 'clubs'] : ['hearts', 'diamonds'];
            
            const alternateColorJokers = alternateSuits.map(suit => ({ 
                rank: wildcard.rank, 
                suit,
                isJoker: true,
                jokerType: 'alternateColor'
            }));
            
            const getCardValue = (rank) => {
                if (rank === 'ace') return 1;
                if (['jack', 'queen', 'king'].includes(rank)) return ['jack', 'queen', 'king'].indexOf(rank) + 11;
                return parseInt(rank);
            };
            
            const wildValue = getCardValue(wildcard.rank);
            const oneUpValue = wildValue === 13 ? 1 : wildValue + 1;
            const oneUpRank = oneUpValue === 1 ? 'ace' : 
                             oneUpValue === 11 ? 'jack' :
                             oneUpValue === 12 ? 'queen' :
                             oneUpValue === 13 ? 'king' : oneUpValue.toString();
            
            const oneUpJokers = [{ 
                rank: oneUpRank, 
                suit: wildcard.suit,
                isJoker: true,
                jokerType: 'oneUp'
            }];
            
            return { alternateColorJokers, oneUpJokers };
        };

        // Simple bot decision making (simplified version)
        const simpleBotDecision = (bot, gameState) => {
            const { drawPile, discardPile } = gameState;
            
            // Simple strategy: randomly decide to take from discard or draw pile
            const takeFromDiscard = Math.random() > 0.5 && discardPile.length > 0;
            
            // Find worst card to discard (simplified)
            const worstCard = bot.hand[Math.floor(Math.random() * bot.hand.length)];
            
            return {
                action: takeFromDiscard ? 'takeDiscard' : 'drawFromPile',
                discardCard: worstCard,
                canDeclare: false, // Simplified - bots don't declare in this version
                confidence: 0.5
            };
        };

        // Simple winning combination checker
        const simpleFindWinningCombination = (hand, jokers) => {
            // Simplified - just check if we have enough cards
            if (hand.length === 14) {
                // For this test, we'll say it's a win if we have 14 cards
                // In a real implementation, this would check for valid combinations
                return { valid: true, message: 'Simplified win check' };
            }
            return { valid: false, error: 'Not enough cards' };
        };

        // Simple 3-bot game simulation
        const simulateSimple3BotGame = () => {
            console.log('\nüéÆ === SIMPLE 3-BOT RUMMY GAME SIMULATION ===\n');
            
            // Initialize game
            const deck = createFullDeck();
            const wildcard = deck.pop(); // Last card as wildcard
            const jokers = createSimulationJokers(wildcard);
            
            console.log(`üÉè Wildcard: ${wildcard.displayRank}${wildcard.displaySuit}`);
            console.log(`üé≠ Jokers: ${[...jokers.alternateColorJokers, ...jokers.oneUpJokers].map(j => `${j.rank}${j.suit[0].toUpperCase()}`).join(', ')}`);
            
            // Create bots
            const bots = [
                { id: 1, name: 'Sebastian', isBot: true, hand: [] },
                { id: 2, name: 'Isaiah', isBot: true, hand: [] },
                { id: 3, name: 'Marcus', isBot: true, hand: [] }
            ];
            
            // Deal 13 cards to each bot
            bots.forEach(bot => {
                for (let i = 0; i < 13; i++) {
                    if (deck.length > 0) {
                        bot.hand.push(deck.pop());
                    }
                }
                console.log(`ü§ñ ${bot.name}: ${bot.hand.length} cards dealt`);
            });
            
            // Initialize game state
            const gameState = {
                players: bots,
                drawPile: deck,
                discardPile: [],
                jokers,
                turnCount: 0
            };
            
            // Add initial discard
            if (deck.length > 0) {
                gameState.discardPile.push(deck.pop());
                console.log(`üóëÔ∏è Initial discard: ${gameState.discardPile[0].displayRank}${gameState.discardPile[0].displaySuit}`);
            }
            
            console.log(`\nüé≤ Starting game with ${gameState.drawPile.length} cards in draw pile\n`);
            
            // Game loop
            let currentPlayerIndex = 0;
            let gameWinner = null;
            let maxTurns = 50; // Shorter for simple test
            
            while (!gameWinner && gameState.turnCount < maxTurns && gameState.drawPile.length > 0) {
                const currentBot = bots[currentPlayerIndex];
                gameState.turnCount++;
                
                console.log(`\n--- Turn ${gameState.turnCount}: ${currentBot.name} ---`);
                console.log(`üìã Hand size: ${currentBot.hand.length} cards`);
                console.log(`üé≤ Draw pile: ${gameState.drawPile.length} cards`);
                console.log(`üóëÔ∏è Discard pile: ${gameState.discardPile.length} cards`);
                
                // Bot makes decision
                const decision = simpleBotDecision(currentBot, gameState);
                
                console.log(`üß† Decision: ${decision.action}`);
                console.log(`üóëÔ∏è Will discard: ${decision.discardCard.displayRank}${decision.discardCard.displaySuit}`);
                
                // Execute bot action
                if (decision.action === 'takeDiscard' && gameState.discardPile.length > 0) {
                    const drawnCard = gameState.discardPile.pop();
                    currentBot.hand.push(drawnCard);
                    console.log(`üì§ Took from discard: ${drawnCard.displayRank}${drawnCard.displaySuit}`);
                } else if (gameState.drawPile.length > 0) {
                    const drawnCard = gameState.drawPile.pop();
                    currentBot.hand.push(drawnCard);
                    console.log(`üé≤ Drew from pile: ${drawnCard.displayRank}${drawnCard.displaySuit}`);
                }
                
                // Check for win after drawing (simplified)
                if (decision.canDeclare && currentBot.hand.length === 14) {
                    console.log(`\nüèÜ ${currentBot.name} DECLARES RUMMY!`);
                    gameWinner = currentBot;
                    break;
                }
                
                // Discard card
                currentBot.hand = currentBot.hand.filter(card => card.id !== decision.discardCard.id);
                gameState.discardPile.push(decision.discardCard);
                
                console.log(`üì§ Discarded: ${decision.discardCard.displayRank}${decision.discardCard.displaySuit}`);
                console.log(`üìã Final hand size: ${currentBot.hand.length} cards`);
                
                // Next player
                currentPlayerIndex = (currentPlayerIndex + 1) % bots.length;
            }
            
            // Game summary
            console.log('\nüèÅ === GAME SUMMARY ===');
            if (gameWinner) {
                console.log(`üéâ Winner: ${gameWinner.name}`);
                console.log(`üéØ Game completed in ${gameState.turnCount} turns`);
            } else if (gameState.turnCount >= maxTurns) {
                console.log(`‚è∞ Game ended due to turn limit (${maxTurns} turns)`);
            } else if (gameState.drawPile.length === 0) {
                console.log(`üÉè Game ended due to empty draw pile`);
            }
            
            console.log('\nüìä Final Hand Sizes:');
            bots.forEach(bot => {
                console.log(`   ${bot.name}: ${bot.hand.length} cards`);
            });
            
            return {
                winner: gameWinner,
                turns: gameState.turnCount,
                completed: !!gameWinner,
                drawPileRemaining: gameState.drawPile.length
            };
        };

        // Console output capture
        const originalLog = console.log;
        const originalError = console.error;
        const consoleElement = document.getElementById('console');
        
        function addToConsole(message, isError = false) {
            const div = document.createElement('div');
            div.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
            if (isError) div.style.color = '#ff6b6b';
            consoleElement.appendChild(div);
            consoleElement.scrollTop = consoleElement.scrollHeight;
        }
        
        console.log = function(...args) {
            originalLog.apply(console, args);
            const message = args.map(arg => 
                typeof arg === 'object' ? JSON.stringify(arg, null, 2) : String(arg)
            ).join(' ');
            addToConsole(message);
        };
        
        console.error = function(...args) {
            originalError.apply(console, args);
            const message = args.map(arg => 
                typeof arg === 'object' ? JSON.stringify(arg, null, 2) : String(arg)
            ).join(' ');
            addToConsole(message, true);
        };
        
        console.log('üöÄ Simple Enhanced Bot Test loaded successfully!');
        
        // Test functions
        function showLoading() {
            document.getElementById('loading').style.display = 'block';
        }
        
        function hideLoading() {
            document.getElementById('loading').style.display = 'none';
        }
        
        async function runSingleGame() {
            showLoading();
            console.log('\nüéØ === RUNNING SINGLE SIMPLE GAME ===');
            
            try {
                const result = simulateSimple3BotGame();
                console.log('\n‚úÖ Single game completed!');
                if (result.completed) {
                    console.log(`üèÜ Winner: ${result.winner.name}`);
                    console.log(`‚è±Ô∏è Game completed in ${result.turns} turns`);
                } else {
                    console.log('‚ùå No winner - game ended without declaration');
                }
            } catch (error) {
                console.error('‚ùå Error running single game:', error);
            } finally {
                hideLoading();
            }
        }
        
        async function run5Games() {
            showLoading();
            console.log('\nüé≤ === RUNNING 5 SIMPLE GAMES ===');
            
            try {
                const results = [];
                for (let i = 1; i <= 5; i++) {
                    console.log(`\nüéÆ === GAME ${i}/5 ===`);
                    const result = simulateSimple3BotGame();
                    results.push(result);
                }
                
                console.log('\n‚úÖ 5 games completed!');
                console.log(`üìä Results: ${results.filter(r => r.completed).length}/5 games completed successfully`);
            } catch (error) {
                console.error('‚ùå Error running 5 games:', error);
            } finally {
                hideLoading();
            }
        }
        
        function clearConsole() {
            const consoleElement = document.getElementById('console');
            consoleElement.innerHTML = `
                <div>üéÆ Simple Enhanced Bot Test Console</div>
                <div>Console cleared...</div>
            `;
        }
        
        // Make functions available globally
        window.runSingleGame = runSingleGame;
        window.run5Games = run5Games;
        window.clearConsole = clearConsole;
    </script>
</body>
</html> 